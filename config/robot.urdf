<?xml version="1.0"?>
<robot name="letter_writer_4dof">

  <!-- Material Definitions -->
  <material name="white">
    <color rgba="1.0 1.0 1.0 1.0"/>
  </material>

  <material name="cardboard_color">
    <color rgba="0.9 0.85 0.7 1.0"/>
  </material>

  <!-- Robot Link Materials -->
  <material name="steel">
    <color rgba="0.5 0.5 0.5 1.0"/>
  </material>

  <material name="aluminum">
    <color rgba="0.75 0.75 0.8 1.0"/>
  </material>

  <material name="carbon_fiber">
    <color rgba="0.2 0.2 0.2 1.0"/>
  </material>

  <!-- World Link (fixed ground reference) -->
  <link name="world">
  </link>

  <!-- Base Link (rotates on ground) -->
  <!-- Material: Steel 1018 hollow tube (3mm wall) -->
  <!-- r_outer=0.03m, r_inner=0.027m, L=0.45m, density=7850 kg/m^3 -->
  <!-- Motor: 10 N*m AC servo + 1:2 gear reducer, mass=6.5 kg (at base) -->
  <link name="base_link">
    <visual>
      <geometry>
        <cylinder radius="0.03" length="0.45"/>
      </geometry>
      <origin xyz="0 0 0.225" rpy="0 0 0"/>
      <material name="steel"/>
    </visual>
    <inertial>
      <mass value="8.405"/>
      <origin xyz="0 0 0.225" rpy="0 0 0"/>
      <inertia ixx="0.03256" iyy="0.03256" izz="0.001639" ixy="0" ixz="0" iyz="0"/>
    </inertial>
  </link>

  <!-- Joint 0: Ground to Base Rotation (Revolute - Rz) -->
  <!-- Origin rotated 90 degrees left (pi/2 radians around Z) so zero position faces left -->
  <joint name="world_to_base_joint" type="revolute">
    <parent link="world"/>
    <child link="base_link"/>
    <origin xyz="0 0 0" rpy="0 0 1.5708"/>
    <axis xyz="0 0 1"/>
    <limit lower="-1.5708" upper="1.5708" effort="100.0" velocity="2.0"/>
  </joint>

  <!-- Joint 1: Shoulder Pitch (Revolute - Ry) -->
  <joint name="base_joint" type="revolute">
    <parent link="base_link"/>
    <child link="shoulder_base_link"/>
    <origin xyz="0 0 0.45" rpy="0 0 0"/>
    <axis xyz="0 1 0"/>
    <limit lower="-1.57" upper="1.57" effort="100.0" velocity="2.0"/>
  </joint>

  <!-- Shoulder Base Link (before prismatic extension) -->
  <!-- Material: Aluminum 6061 hollow tube (3mm wall) -->
  <!-- r_outer=0.025m, r_inner=0.022m, L=0.1m, density=2700 kg/m^3 -->
  <!-- Motor: 5 N*m AC servo + 1:2 gear + linear actuator, total motor mass=3.228 kg -->
  <link name="shoulder_base_link">
    <!-- Outer cylinder (static) -->
    <visual>
      <geometry>
        <cylinder radius="0.025" length="0.1"/>
      </geometry>
      <origin xyz="0.05 0 0" rpy="0 1.5708 0"/>
      <material name="aluminum"/>
    </visual>
    <inertial>
      <mass value="3.348"/>
      <origin xyz="0.05 0 0" rpy="0 0 0"/>
      <inertia ixx="0.000067" iyy="0.000110" izz="0.000110" ixy="0" ixz="0" iyz="0"/>
    </inertial>
  </link>

  <!-- Joint 2: Shoulder Extension (Prismatic - extends along X) -->
  <joint name="shoulder_extend_joint" type="prismatic">
    <parent link="shoulder_base_link"/>
    <child link="shoulder_link"/>
    <origin xyz="0.0 0 0" rpy="0 0 0"/>
    <axis xyz="1 0 0"/>
    <limit lower="0.0" upper="0.40" effort="50.0" velocity="0.5"/>
  </joint>

  <!-- Shoulder Link (after prismatic extension) -->
  <!-- Material: Carbon Fiber hollow tubes (3mm wall) + solid sphere -->
  <!-- r_outer=0.0125m, r_inner=0.0095m, density=1600 kg/m^3 -->
  <!-- Motor: 1.2 N*m NEMA 23 stepper at elbow joint, mass=0.75 kg -->
  <link name="shoulder_link">
    <!-- Horizontal cylinder from parent -->
    <!-- Extends backwards 0.40m to connect with parent -->
    <!-- Length is 0.40m to cover max prismatic extension of 0.40m plus overlap -->
    <visual>
      <geometry>
        <cylinder radius="0.0125" length="0.40"/>
      </geometry>
      <origin xyz="-0.20 0 0" rpy="0 1.5708 0"/>
      <material name="carbon_fiber"/>
    </visual>
    <!-- Horizontal extension from origin to bend point -->
    <visual>
      <geometry>
        <cylinder radius="0.0125" length="0.22"/>
      </geometry>
      <origin xyz="0.11 0 0" rpy="0 1.5708 0"/>
      <material name="carbon_fiber"/>
    </visual>
    <!-- Junction sphere at bend point (where horizontal meets vertical) -->
    <visual>
      <geometry>
        <sphere radius="0.0125"/>
      </geometry>
      <origin xyz="0.22 0 0" rpy="0 0 0"/>
      <material name="carbon_fiber"/>
    </visual>
    <!-- Vertical offset cylinder perpendicular in +Y direction at bend -->
    <!-- L-shape: goes from (0.22, 0, 0) upward to (0.22, 0.03, 0) -->
    <visual>
      <geometry>
        <cylinder radius="0.0125" length="0.03"/>
      </geometry>
      <origin xyz="0.22 0.015 0" rpy="1.5708 0 0"/>
      <material name="carbon_fiber"/>
    </visual>
    <inertial>
      <mass value="1.058"/>
      <origin xyz="0 0.001 0" rpy="0 0 0"/>
      <inertia ixx="0.0105" iyy="0.0105" izz="0.00003" ixy="0" ixz="0" iyz="0"/>
    </inertial>
  </link>

  <!-- Joint 3: Elbow Pitch (Revolute) with OFFSET -->
  <joint name="elbow_joint" type="revolute">
    <parent link="shoulder_link"/>
    <child link="elbow_link"/>
    <origin xyz="0.22 0.03 0" rpy="1.5708 0 0"/>
    <axis xyz="0 0 1"/>
    <limit lower="-1.57" upper="1.57" effort="40.0" velocity="2.0"/>
  </joint>

  <!-- Elbow Link (0.10m, cylinder shape) -->
  <!-- Material: Carbon Fiber hollow tube (3mm wall) -->
  <!-- r_outer=0.0125m, r_inner=0.0095m, L=0.10m, density=1600 kg/m^3 -->
  <!-- Motor: 0.5 N*m stepper at wrist joint, mass=0.35 kg -->
  <link name="elbow_link">
    <!-- Connection sphere at elbow joint -->
    <visual>
      <geometry>
        <sphere radius="0.0125"/>
      </geometry>
      <origin xyz="0 0 0" rpy="0 0 0"/>
      <material name="carbon_fiber"/>
    </visual>
    <!-- Main cylinder extending from joint -->
    <visual>
      <geometry>
        <cylinder radius="0.0125" length="0.10"/>
      </geometry>
      <!-- After rpy rotation in joint, local X goes along parent's Y -->
      <!-- Cylinder extends from joint (0,0,0) to (0.10,0,0) in rotated frame -->
      <origin xyz="0.05 0 0" rpy="0 1.5708 0"/>
      <material name="carbon_fiber"/>
    </visual>
    <inertial>
      <mass value="0.395"/>
      <origin xyz="0.05 0 0" rpy="0 0 0"/>
      <inertia ixx="0.000007" iyy="0.000051" izz="0.000051" ixy="0" ixz="0" iyz="0"/>
    </inertial>
  </link>

  <!-- Joint 4: Wrist Pitch (Revolute - Ry) -->
  <joint name="wrist_joint" type="revolute">
    <parent link="elbow_link"/>
    <child link="wrist_link"/>
    <origin xyz="0.10 0 0" rpy="0 0 0"/>
    <axis xyz="0 1 0"/>
    <limit lower="-1.0472" upper="0.35" effort="20.0" velocity="2.0"/>
  </joint>

  <!-- Wrist Link (reduced to 0.12m) -->
  <!-- Material: Carbon Fiber hollow tube (3mm wall) -->
  <!-- r_outer=0.01m, r_inner=0.007m, L=0.12m, density=1600 kg/m^3 -->
  <link name="wrist_link">
    <visual>
      <geometry>
        <cylinder radius="0.01" length="0.12"/>
      </geometry>
      <origin xyz="0.06 0 0" rpy="0 1.5708 0"/>
      <material name="carbon_fiber"/>
    </visual>
    <inertial>
      <mass value="0.031"/>
      <origin xyz="0.06 0 0" rpy="0 0 0"/>
      <inertia ixx="0.000002" iyy="0.000041" izz="0.000041" ixy="0" ixz="0" iyz="0"/>
    </inertial>
  </link>

  <!-- End Effector (Pen) -->
  <!-- Material: Aluminum 6061 solid sphere -->
  <!-- r=0.01m, density=2700 kg/m^3 -->
  <link name="end_effector">
    <visual>
      <geometry>
        <sphere radius="0.01"/>
      </geometry>
      <origin xyz="0 0 0" rpy="0 0 0"/>
      <material name="aluminum"/>
    </visual>
    <inertial>
      <mass value="0.011"/>
      <origin xyz="0 0 0" rpy="0 0 0"/>
      <inertia ixx="0.00000044" iyy="0.00000044" izz="0.00000044" ixy="0" ixz="0" iyz="0"/>
    </inertial>
  </link>

  <!-- Fixed joint to attach end effector -->
  <joint name="end_effector_joint" type="fixed">
    <parent link="wrist_link"/>
    <child link="end_effector"/>
    <origin xyz="0.15 0 0" rpy="0 0 0"/>
  </joint>

  <!-- TEMPORARY: Cardboard visualization (for URDF viewer only) -->
  <!-- Cardboard surface (vertical in XZ plane) -->
  <link name="cardboard">
    <visual>
      <geometry>
        <!-- Box: [width_X, depth_Y, height_Z] -->
        <!-- Cardboard is 1.20m wide (X), 0.01m thick (Y), 0.60m tall (Z) -->
        <box size="1.20 0.01 0.60"/>
      </geometry>
      <origin xyz="0 0 0" rpy="0 0 0"/>
      <material name="cardboard_color"/>
    </visual>
    <inertial>
      <mass value="0.1"/>
      <origin xyz="0 0 0" rpy="0 0 0"/>
      <inertia ixx="0.001" iyy="0.001" izz="0.001" ixy="0" ixz="0" iyz="0"/>
    </inertial>
  </link>

  <!-- Fixed joint to position cardboard in workspace -->
  <!-- Position from config.yaml: cardboard_position = [0.0, 0.55, 0.5] -->
  <!-- This is center of cardboard, shifted forward by half thickness (0.005m) -->
  <!-- so front surface (facing robot) is at Y = 0.55 -->
  <joint name="cardboard_fixed" type="fixed">
    <parent link="world"/>
    <child link="cardboard"/>
    <origin xyz="0.0 0.555 0.5" rpy="0 0 0"/>
  </joint>

</robot>
