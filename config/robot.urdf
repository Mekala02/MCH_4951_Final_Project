<?xml version="1.0"?>
<robot name="letter_writer_4dof">

  <!-- Material Definitions -->
  <material name="white">
    <color rgba="1.0 1.0 1.0 1.0"/>
  </material>

  <material name="cardboard_color">
    <color rgba="0.9 0.85 0.7 1.0"/>
  </material>

  <!-- World Link (fixed ground reference) -->
  <link name="world">
  </link>

  <!-- Base Link (rotates on ground) -->
  <link name="base_link">
    <visual>
      <geometry>
        <cylinder radius="0.03" length="0.45"/>
      </geometry>
      <origin xyz="0 0 0.225" rpy="0 0 0"/>
      <material name="white"/>
    </visual>
    <inertial>
      <mass value="4.0"/>
      <origin xyz="0 0 0.225" rpy="0 0 0"/>
      <inertia ixx="0.703" iyy="0.706" izz="0.009" ixy="0" ixz="0" iyz="0"/>
    </inertial>
  </link>

  <!-- Joint 0: Ground to Base Rotation (Revolute - Rz) -->
  <!-- Origin rotated 90 degrees left (pi/2 radians around Z) so zero position faces left -->
  <joint name="world_to_base_joint" type="revolute">
    <parent link="world"/>
    <child link="base_link"/>
    <origin xyz="0 0 0" rpy="0 0 1.5708"/>
    <axis xyz="0 0 1"/>
    <limit lower="-1.5708" upper="1.5708" effort="100.0" velocity="2.0"/>
  </joint>

  <!-- Joint 1: Shoulder Pitch (Revolute - Ry) -->
  <joint name="base_joint" type="revolute">
    <parent link="base_link"/>
    <child link="shoulder_base_link"/>
    <origin xyz="0 0 0.45" rpy="0 0 0"/>
    <axis xyz="0 1 0"/>
    <limit lower="-1.57" upper="1.57" effort="100.0" velocity="2.0"/>
  </joint>

  <!-- Shoulder Base Link (before prismatic extension) -->
  <link name="shoulder_base_link">
    <!-- Outer cylinder (static) -->
    <visual>
      <geometry>
        <cylinder radius="0.025" length="0.1"/>
      </geometry>
      <origin xyz="0.05 0 0" rpy="0 1.5708 0"/>
      <material name="white"/>
    </visual>
    <inertial>
      <mass value="1.5"/>
      <origin xyz="0.05 0 0" rpy="0 0 0"/>
      <inertia ixx="0.013" iyy="0.013" izz="0.0005" ixy="0" ixz="0" iyz="0"/>
    </inertial>
  </link>

  <!-- Joint 2: Shoulder Extension (Prismatic - extends along X) -->
  <joint name="shoulder_extend_joint" type="prismatic">
    <parent link="shoulder_base_link"/>
    <child link="shoulder_link"/>
    <origin xyz="0.0 0 0" rpy="0 0 0"/>
    <axis xyz="1 0 0"/>
    <limit lower="0.0" upper="0.40" effort="50.0" velocity="0.5"/>
  </joint>

  <!-- Shoulder Link (after prismatic extension) -->
  <link name="shoulder_link">
    <!-- Horizontal cylinder from parent -->
    <!-- Extends backwards 0.40m to connect with parent -->
    <!-- Length is 0.40m to cover max prismatic extension of 0.40m plus overlap -->
    <visual>
      <geometry>
        <cylinder radius="0.0125" length="0.40"/>
      </geometry>
      <origin xyz="-0.20 0 0" rpy="0 1.5708 0"/>
      <material name="white"/>
    </visual>
    <!-- Horizontal extension from origin to bend point -->
    <visual>
      <geometry>
        <cylinder radius="0.0125" length="0.22"/>
      </geometry>
      <origin xyz="0.11 0 0" rpy="0 1.5708 0"/>
      <material name="white"/>
    </visual>
    <!-- Junction sphere at bend point (where horizontal meets vertical) -->
    <visual>
      <geometry>
        <sphere radius="0.0125"/>
      </geometry>
      <origin xyz="0.22 0 0" rpy="0 0 0"/>
      <material name="white"/>
    </visual>
    <!-- Vertical offset cylinder perpendicular in +Y direction at bend -->
    <!-- L-shape: goes from (0.22, 0, 0) upward to (0.22, 0.03, 0) -->
    <visual>
      <geometry>
        <cylinder radius="0.0125" length="0.03"/>
      </geometry>
      <origin xyz="0.22 0.015 0" rpy="1.5708 0 0"/>
      <material name="white"/>
    </visual>
    <inertial>
      <mass value="2.0"/>
      <origin xyz="0.11 0.015 0" rpy="0 0 0"/>
      <inertia ixx="0.15" iyy="0.15" izz="0.0008" ixy="0" ixz="0" iyz="0"/>
    </inertial>
  </link>

  <!-- Joint 3: Elbow Pitch (Revolute) with OFFSET -->
  <joint name="elbow_joint" type="revolute">
    <parent link="shoulder_link"/>
    <child link="elbow_link"/>
    <origin xyz="0.22 0.03 0" rpy="1.5708 0 0"/>
    <axis xyz="0 0 1"/>
    <limit lower="-1.57" upper="1.57" effort="40.0" velocity="2.0"/>
  </joint>

  <!-- Elbow Link (0.10m, cylinder shape) -->
  <link name="elbow_link">
    <!-- Connection sphere at elbow joint -->
    <visual>
      <geometry>
        <sphere radius="0.0125"/>
      </geometry>
      <origin xyz="0 0 0" rpy="0 0 0"/>
      <material name="white"/>
    </visual>
    <!-- Main cylinder extending from joint -->
    <visual>
      <geometry>
        <cylinder radius="0.0125" length="0.10"/>
      </geometry>
      <!-- After rpy rotation in joint, local X goes along parent's Y -->
      <!-- Cylinder extends from joint (0,0,0) to (0.10,0,0) in rotated frame -->
      <origin xyz="0.05 0 0" rpy="0 1.5708 0"/>
      <material name="white"/>
    </visual>
    <inertial>
      <mass value="1.8"/>
      <origin xyz="0.05 0 0" rpy="0 0 0"/>
      <inertia ixx="0.045" iyy="0.045" izz="0.0004" ixy="0" ixz="0" iyz="0"/>
    </inertial>
  </link>

  <!-- Joint 4: Wrist Pitch (Revolute - Ry) -->
  <joint name="wrist_joint" type="revolute">
    <parent link="elbow_link"/>
    <child link="wrist_link"/>
    <origin xyz="0.10 0 0" rpy="0 0 0"/>
    <axis xyz="0 1 0"/>
    <limit lower="-1.0472" upper="0.35" effort="20.0" velocity="2.0"/>
  </joint>

  <!-- Wrist Link (reduced to 0.12m) -->
  <link name="wrist_link">
    <visual>
      <geometry>
        <cylinder radius="0.01" length="0.12"/>
      </geometry>
      <origin xyz="0.06 0 0" rpy="0 1.5708 0"/>
      <material name="white"/>
    </visual>
    <inertial>
      <mass value="1.0"/>
      <origin xyz="0.06 0 0" rpy="0 0 0"/>
      <inertia ixx="0.019" iyy="0.019" izz="0.00005" ixy="0" ixz="0" iyz="0"/>
    </inertial>
  </link>

  <!-- End Effector (Pen) -->
  <link name="end_effector">
    <visual>
      <geometry>
        <sphere radius="0.01"/>
      </geometry>
      <origin xyz="0 0 0" rpy="0 0 0"/>
      <material name="white"/>
    </visual>
    <inertial>
      <mass value="0.07"/>
      <origin xyz="0 0 0" rpy="0 0 0"/>
      <inertia ixx="0.00001" iyy="0.00001" izz="0.00001" ixy="0" ixz="0" iyz="0"/>
    </inertial>
  </link>

  <!-- Fixed joint to attach end effector -->
  <joint name="end_effector_joint" type="fixed">
    <parent link="wrist_link"/>
    <child link="end_effector"/>
    <origin xyz="0.15 0 0" rpy="0 0 0"/>
  </joint>

  <!-- TEMPORARY: Cardboard visualization (for URDF viewer only) -->
  <!-- Cardboard surface (vertical in XZ plane) -->
  <link name="cardboard">
    <visual>
      <geometry>
        <!-- Box: [width_X, depth_Y, height_Z] -->
        <!-- Cardboard is 1.20m wide (X), 0.01m thick (Y), 0.60m tall (Z) -->
        <box size="1.20 0.01 0.60"/>
      </geometry>
      <origin xyz="0 0 0" rpy="0 0 0"/>
      <material name="cardboard_color"/>
    </visual>
    <inertial>
      <mass value="0.1"/>
      <origin xyz="0 0 0" rpy="0 0 0"/>
      <inertia ixx="0.001" iyy="0.001" izz="0.001" ixy="0" ixz="0" iyz="0"/>
    </inertial>
  </link>

  <!-- Fixed joint to position cardboard in workspace -->
  <!-- Position from config.yaml: cardboard_position = [0.0, 0.55, 0.5] -->
  <!-- This is center of cardboard, shifted forward by half thickness (0.005m) -->
  <!-- so front surface (facing robot) is at Y = 0.55 -->
  <joint name="cardboard_fixed" type="fixed">
    <parent link="world"/>
    <child link="cardboard"/>
    <origin xyz="0.0 0.555 0.5" rpy="0 0 0"/>
  </joint>

</robot>
